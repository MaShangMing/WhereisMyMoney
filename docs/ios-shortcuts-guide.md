# iOS 快捷指令配置指南

本指南帮助你配置 iOS 快捷指令（Shortcuts），实现微信/支付宝支付通知的自动记账。

## 原理说明

iOS 系统限制第三方 App 无法直接读取其他 App 的通知内容。但通过「快捷指令」App 的自动化功能，我们可以：

1. 在收到特定 App 通知时触发自动化
2. 将通知内容通过 URL Scheme 发送到「我的账本」App
3. App 自动解析并创建待确认的记账记录

## 配置步骤

### 步骤 1：创建快捷指令

1. 打开「快捷指令」App
2. 点击右上角 `+` 创建新快捷指令
3. 点击「添加操作」
4. 搜索并添加「打开 URL」操作
5. 在 URL 中输入：
   ```
   whereismymoney://add?text=快捷指令输入
   ```
6. 点击右上角完成，命名为「记账助手」

### 步骤 2：创建自动化

#### 微信支付通知自动化

1. 打开「快捷指令」App
2. 点击底部「自动化」标签
3. 点击右上角 `+` 
4. 选择「创建个人自动化」
5. 向下滚动，选择「通知」
6. 选择「微信」App
7. 确保勾选「立即运行」和「收到通知时」
8. 点击「下一步」
9. 添加操作：
   - 搜索「获取通知内容」
   - 搜索「打开 URL」，URL 设置为：
     ```
     whereismymoney://add?text=通知内容&source=wechat
     ```
   - 将「通知内容」变量插入到 text= 后面
10. 关闭「运行前询问」
11. 完成

#### 支付宝支付通知自动化

重复上述步骤，但在第 6 步选择「支付宝」App，URL 中 source 改为 `alipay`。

### 步骤 3：测试

1. 使用微信/支付宝进行一笔小额支付
2. 收到通知后，检查「我的账本」App 的待确认列表
3. 如果出现新记录，说明配置成功

## URL Scheme 参数说明

| 参数 | 说明 | 示例 |
|-----|------|------|
| text | 通知原文 | 支付成功，已扣款￥25.00 |
| amount | 金额（可选，会自动解析） | 25.00 |
| merchant | 商户名（可选） | 瑞幸咖啡 |
| type | 类型（可选） | expense / income |
| source | 来源（可选） | wechat / alipay |

## 完整 URL 示例

```
whereismymoney://add?text=微信支付成功，已扣款￥25.00，商户：瑞幸咖啡&source=wechat
```

## 高级配置

### 自动判断支出/收入

在快捷指令中添加条件判断：

1. 添加「如果」操作
2. 条件：通知内容 包含 "收款"
3. 是：type=income
4. 否：type=expense

### 过滤非支付通知

在打开 URL 之前添加条件：

1. 添加「如果」操作
2. 条件：通知内容 包含 "支付" 或 "付款" 或 "收款"
3. 只在条件满足时执行后续操作

## 常见问题

### Q: 自动化没有触发？

A: 检查以下设置：
- 确保「快捷指令」有通知权限
- 确保自动化没有被关闭
- 确保「运行前询问」已关闭

### Q: App 没有收到数据？

A: 检查以下设置：
- 确保 URL Scheme 格式正确
- 确保 App 已注册 `whereismymoney://` 协议
- 尝试手动在 Safari 中打开 URL 测试

### Q: 如何查看自动化运行日志？

A: 在「快捷指令」App 中：
1. 进入「自动化」标签
2. 点击对应的自动化
3. 查看底部的「历史记录」

## 隐私说明

- 快捷指令在本地运行，不会上传数据
- 通知内容仅用于解析支付信息
- 所有数据存储在你的设备上
